<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laboratorium Gelombang Suara</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&display=swap');
        
        body {
            font-family: 'Fredoka', sans-serif;
            background-color: #f0f9ff; /* Light Blue */
            color: #334155;
        }

        /* Styling Slider Custom */
        input[type=range] {
            -webkit-appearance: none; 
            width: 100%; 
            background: transparent; 
        }
        
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #0ea5e9;
            cursor: pointer;
            margin-top: -8px; 
            box-shadow: 0 0 5px rgba(0,0,0,0.2);
        }
        
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #cbd5e1;
            border-radius: 2px;
        }

        /* Canvas Oscilloscope Grid Background */
        .oscilloscope-bg {
            background-color: #0f172a;
            background-image: 
                linear-gradient(rgba(30, 41, 59, 0.5) 1px, transparent 1px),
                linear-gradient(90deg, rgba(30, 41, 59, 0.5) 1px, transparent 1px);
            background-size: 20px 20px;
        }

        .btn-glow {
            animation: pulse-glow 2s infinite;
        }

        @keyframes pulse-glow {
            0% { box-shadow: 0 0 0 0 rgba(14, 165, 233, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(14, 165, 233, 0); }
            100% { box-shadow: 0 0 0 0 rgba(14, 165, 233, 0); }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- Header -->
    <header class="bg-sky-600 text-white p-6 shadow-lg text-center relative z-10">
        <h1 class="text-3xl font-bold mb-1">üîä Laboratorium Gelombang Suara</h1>
        <p class="opacity-90 text-sm">Eksperimen Hubungan Frekuensi, Amplitudo, dan Bunyi</p>
    </header>

    <main class="flex-grow max-w-5xl mx-auto w-full p-4 md:p-8 grid grid-cols-1 lg:grid-cols-12 gap-8">
        
        <!-- Controls Section -->
        <section class="lg:col-span-4 space-y-6">
            
            <!-- Power Button -->
            <div class="bg-white p-6 rounded-2xl shadow-md border-t-4 border-sky-500 text-center">
                <p class="mb-4 text-sm text-slate-500">Klik tombol di bawah untuk mengaktifkan alat suara.</p>
                <button id="toggle-btn" class="w-full py-3 px-6 rounded-xl font-bold text-white transition-all transform active:scale-95 bg-slate-400 hover:bg-slate-500 shadow-lg flex items-center justify-center gap-2">
                    <span id="btn-icon">üîá</span>
                    <span id="btn-text">Nyalakan Alat</span>
                </button>
            </div>

            <!-- Sliders Control -->
            <div class="bg-white p-6 rounded-2xl shadow-md border-t-4 border-indigo-500 space-y-8">
                
                <!-- Frequency Control -->
                <div>
                    <div class="flex justify-between items-end mb-2">
                        <label class="font-bold text-indigo-600 flex items-center gap-2">
                            <span>„Ä∞Ô∏è</span> Frekuensi (Pitch)
                        </label>
                        <span class="text-xs bg-indigo-100 text-indigo-700 px-2 py-1 rounded font-mono" id="freq-val">440 Hz</span>
                    </div>
                    <input type="range" id="freq-slider" min="100" max="1000" step="1" value="440" disabled>
                    <p class="text-xs text-slate-400 mt-2">Semakin tinggi frekuensi, nada semakin tinggi dan gelombang semakin rapat.</p>
                </div>

                <!-- Amplitude Control -->
                <div>
                    <div class="flex justify-between items-end mb-2">
                        <label class="font-bold text-sky-600 flex items-center gap-2">
                            <span>üì¢</span> Amplitudo (Volume)
                        </label>
                        <span class="text-xs bg-sky-100 text-sky-700 px-2 py-1 rounded font-mono" id="amp-val">50%</span>
                    </div>
                    <input type="range" id="amp-slider" min="0" max="100" step="1" value="50" disabled>
                    <p class="text-xs text-slate-400 mt-2">Semakin tinggi amplitudo, suara semakin keras dan gelombang semakin tinggi.</p>
                </div>

            </div>

            <!-- Legend -->
            <div class="bg-yellow-50 p-4 rounded-xl border border-yellow-200 text-sm text-yellow-800">
                <strong>Tips:</strong> Gunakan headphone untuk mendengar perbedaan frekuensi rendah dengan lebih jelas.
            </div>
        </section>

        <!-- Visualization Section -->
        <section class="lg:col-span-8 flex flex-col gap-4">
            
            <!-- Oscilloscope Screen -->
            <div class="bg-slate-800 p-2 rounded-2xl shadow-xl border-4 border-slate-600 relative">
                <div class="absolute top-4 left-4 text-green-400 font-mono text-xs z-10 opacity-70">
                    OSCILLOSCOPE V.1.0<br>
                    INPUT: SINE WAVE
                </div>
                
                <canvas id="oscilloscope" class="oscilloscope-bg w-full h-80 rounded-xl cursor-crosshair"></canvas>
                
                <!-- Physics Info Overlay -->
                <div class="absolute bottom-4 right-4 text-right">
                    <div class="text-xs text-slate-400 mb-1">Panjang Gelombang ($\lambda$)</div>
                    <div id="wavelength-indicator" class="h-1 bg-green-500 transition-all duration-300 mx-auto ml-auto" style="width: 50px;"></div>
                </div>
            </div>

            <!-- Explanation Box -->
            <div class="grid grid-cols-2 gap-4">
                <div class="bg-white p-4 rounded-xl shadow-sm border-l-4 border-indigo-500">
                    <h3 class="font-bold text-gray-700 mb-1">Frekuensi ($f$)</h3>
                    <p class="text-sm text-gray-600">Jumlah getaran per detik. Menentukan tinggi rendahnya nada.</p>
                </div>
                <div class="bg-white p-4 rounded-xl shadow-sm border-l-4 border-sky-500">
                    <h3 class="font-bold text-gray-700 mb-1">Amplitudo ($A$)</h3>
                    <p class="text-sm text-gray-600">Simpangan terjauh dari titik setimbang. Menentukan keras lemahnya suara.</p>
                </div>
            </div>

        </section>
    </main>

    <script>
        // --- Configuration ---
        const canvas = document.getElementById('oscilloscope');
        const ctxCanvas = canvas.getContext('2d');
        const toggleBtn = document.getElementById('toggle-btn');
        const btnText = document.getElementById('btn-text');
        const btnIcon = document.getElementById('btn-icon');
        const freqSlider = document.getElementById('freq-slider');
        const ampSlider = document.getElementById('amp-slider');
        const freqVal = document.getElementById('freq-val');
        const ampVal = document.getElementById('amp-val');
        const waveIndicator = document.getElementById('wavelength-indicator');

        // Audio Context Variables
        let audioCtx;
        let oscillator;
        let gainNode;
        let isPlaying = false;

        // Animation Variables
        let animationId;
        let phase = 0; // To make the wave move
        
        // --- Resize Canvas Helper ---
        function resizeCanvas() {
            canvas.width = canvas.parentElement.offsetWidth;
            canvas.height = canvas.parentElement.offsetHeight;
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        // --- Core Audio Logic ---
        function initAudio() {
            if (!audioCtx) {
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                audioCtx = new AudioContext();
            }
            
            // Create Oscillator (Source)
            oscillator = audioCtx.createOscillator();
            oscillator.type = 'sine'; // Pure tone
            
            // Create Gain Node (Volume)
            gainNode = audioCtx.createGain();
            
            // Connect: Oscillator -> Gain -> Speakers
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            
            // Set initial values based on sliders
            updateAudioParams();
            
            oscillator.start();
        }

        function updateAudioParams() {
            if (!audioCtx) return;

            const freq = parseFloat(freqSlider.value);
            const ampPercent = parseFloat(ampSlider.value);
            
            // Update UI Text
            freqVal.textContent = `${freq} Hz`;
            ampVal.textContent = `${ampPercent}%`;

            // Update Audio Physics
            // Smooth transition for frequency
            if(oscillator) {
                oscillator.frequency.setTargetAtTime(freq, audioCtx.currentTime, 0.05);
            }
            
            // Update Volume (Logarithmic scale feels more natural, but linear is fine for basic physics)
            // Safety: Max volume is 0.5 to protect ears
            const maxVolume = 0.3; 
            const gainValue = (ampPercent / 100) * maxVolume;
            
            if(gainNode) {
                gainNode.gain.setTargetAtTime(gainValue, audioCtx.currentTime, 0.05);
            }

            // Update Visual Wavelength Indicator (Inverse of Frequency)
            // High freq = Short bar, Low freq = Long bar
            const indicatorWidth = (1100 - freq) / 10; 
            waveIndicator.style.width = `${Math.max(10, indicatorWidth)}px`;
        }

        // --- Toggle Play/Stop ---
        toggleBtn.addEventListener('click', () => {
            if (!isPlaying) {
                // Start
                if (!audioCtx) initAudio();
                if (audioCtx.state === 'suspended') audioCtx.resume();
                
                // If oscillator was stopped/disconnected, we might need to recreate logic
                // But for simple toggle, gain=0 is safer than stop()
                if(gainNode) gainNode.gain.value = 0; 
                
                updateAudioParams(); // Apply current slider values
                
                isPlaying = true;
                
                // UI Update
                toggleBtn.classList.remove('bg-slate-400', 'hover:bg-slate-500');
                toggleBtn.classList.add('bg-rose-500', 'hover:bg-rose-600', 'btn-glow');
                btnText.textContent = "Matikan Alat";
                btnIcon.textContent = "‚èπÔ∏è";
                
                // Enable Sliders
                freqSlider.disabled = false;
                ampSlider.disabled = false;

                // Start Visual Loop
                drawWave();

            } else {
                // Stop (Mute)
                if(gainNode) {
                    gainNode.gain.setTargetAtTime(0, audioCtx.currentTime, 0.1);
                }
                
                isPlaying = false;
                
                // UI Update
                toggleBtn.classList.add('bg-slate-400', 'hover:bg-slate-500');
                toggleBtn.classList.remove('bg-rose-500', 'hover:bg-rose-600', 'btn-glow');
                btnText.textContent = "Nyalakan Alat";
                btnIcon.textContent = "üîá";
                
                // Disable Sliders
                freqSlider.disabled = true;
                ampSlider.disabled = true;

                // Stop Visual Loop (optional, allows CPU rest)
                cancelAnimationFrame(animationId);
                // Clear canvas to flat line
                drawFlatLine();
            }
        });

        // --- Event Listeners for Sliders ---
        freqSlider.addEventListener('input', updateAudioParams);
        ampSlider.addEventListener('input', updateAudioParams);

        // --- Visualization Logic (Canvas) ---
        function drawFlatLine() {
            ctxCanvas.clearRect(0, 0, canvas.width, canvas.height);
            ctxCanvas.beginPath();
            ctxCanvas.strokeStyle = '#22c55e'; // Green
            ctxCanvas.lineWidth = 3;
            ctxCanvas.moveTo(0, canvas.height / 2);
            ctxCanvas.lineTo(canvas.width, canvas.height / 2);
            ctxCanvas.stroke();
        }

        function drawWave() {
            if (!isPlaying) return;

            const width = canvas.width;
            const height = canvas.height;
            const centerY = height / 2;

            ctxCanvas.clearRect(0, 0, width, height);

            ctxCanvas.beginPath();
            ctxCanvas.lineWidth = 3;
            ctxCanvas.strokeStyle = '#22c55e'; // Oscilloscope Green
            ctxCanvas.shadowBlur = 4;
            ctxCanvas.shadowColor = '#22c55e';

            const freq = parseFloat(freqSlider.value);
            const amp = parseFloat(ampSlider.value);

            // Visual Scaling Factors
            // We scale frequency so it looks good visually on canvas (not 1:1 with Hz)
            const visualFreqScale = 0.0005 * freq; 
            // We scale amplitude to fit canvas height
            const visualAmpScale = (amp / 100) * (height / 2.5); 

            // Speed of the wave movement
            const speed = 0.15;
            phase += speed;

            for (let x = 0; x < width; x++) {
                // Math.sin(frequency * x + phase)
                const y = centerY + Math.sin(x * visualFreqScale * Math.PI * 2 + phase) * visualAmpScale;
                
                if (x === 0) {
                    ctxCanvas.moveTo(x, y);
                } else {
                    ctxCanvas.lineTo(x, y);
                }
            }

            ctxCanvas.stroke();
            ctxCanvas.shadowBlur = 0; // Reset for performance

            animationId = requestAnimationFrame(drawWave);
        }

        // Initialize flat line on load
        drawFlatLine();

    </script>
</body>
</html>
